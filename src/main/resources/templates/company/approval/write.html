<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>휴가 신청</title>
    </head>
<!--
    <body>
    <h1>휴가 신청하기</h1>

        <form action="Vacation.jsp" method="post">

            결재 라인 :
            <select id="approver" name="approver">
                <option th:each="approver : ${approver}" th:value="${approver}" th:text="${approver}"></option>
            </select>

            <button type="button" onclick="addApprover()">+</button>
            <br><br>
            제목 : <input type="text" id="title" name="title" length="100" required>
            <br><br>
            휴가 종류 :
            <select id="ApprovalTypeID" name="ApprovalTypeID" required>
                <option value="1">연차</option>
                <option value="2">월차</option>
                <option value="3">반차</option>
                <option value="4">병가</option>
            </select>
            <br><br>
            휴가 날짜 :
            <input type="date" id="StartDate" name="StartDate" required>
            <input type="date" id="FinishDate" name="FinishDate" required>
            <br><br>
            <textarea id="Subject" name="Subject" placeholder="휴가 사유" length="500" required></textarea>
            <br><br>
            <input type="submit" value="제출하기">
        </form>
    </body>

    <script th:inline="javascript">
        function addApprover() {
            var selectApprover = document.createElement("select");
            selectApprover.id = "approver";
            selectApprover.name = "approver";

            [[${approver}]].forEach(function(approver) {
                var option = document.createElement("option");
                option.value = approver;
                option.text = approver;
                selectApprover.add(option);
            });
            var findSelect = document.getElementById("approver");
            findSelect.insertAdjacentElement('afterend', selectApprover);
        }
    </script>
-->
    <body>
        <form action="/company/write" method="post">
            결재 라인 :
            <select name="approver" id="approver" required>
                <option th:each="approver : ${approver}" th:value="${approver}" th:text="${approver}"></option>
            </select>
            <button type="button" onclick="addApprover()">+</button>
            <br><br>
            제목 : <input type="text" name="title" required>
            <br><br>
            휴가 종류 :
            <select name="approvalTypeId" required>
                <option th:each="approvalType : ${approvalType}" th:value="${approvalType.id}" th:text="${approvalType.name}"></option>
            </select>
            <br><br>
            휴가 날짜 :
            <input type="date" name="startDate" id="startDate" required>
            <input type="date" name="endDate" required>
            <br><br>
            내용 : <input type="text" name="content" required>
            <br><br>
            <input type="submit" value="제출하기">
        </form>
    </body>

    <script th:inline="javascript">
        var clickCount = 0; // 클릭 횟수를 저장할 변수 선언

        // JavaScript 함수 정의 시작
        function addApprover() {
            if (clickCount < 2) { // 최대 2번까지 클릭 가능하도록 제한
                clickCount++; // 클릭 횟수 증가

                // 기존의 select 요소를 id를 통해 찾아옵니다.
                var existingSelect = document.getElementById("approver");

                // 새로운 select 요소를 생성합니다.
                var newSelect = document.createElement("select");

                // 새로운 select 요소의 name 속성을 설정합니다.
                newSelect.name = "approver";

                // 필요한 경우 새로운 select 요소에 required 속성을 추가할 수 있습니다.
                newSelect.required = true;

                // Thymeleaf 표현식을 사용하여 옵션을 추가합니다.
                [[${approver}]].forEach(function(approver) {
                    // 각각의 옵션 요소를 생성합니다.
                    var option = document.createElement("option");

                    // 옵션의 값(value)을 설정합니다.
                    option.value = approver;

                    // 옵션에 표시될 텍스트(text)를 설정합니다.
                    option.text = approver;

                    // 새로운 select 요소에 옵션을 추가합니다.
                    newSelect.appendChild(option);
                });

                // 기존의 select 요소 뒤에 새로운 select 요소를 추가합니다.
                existingSelect.insertAdjacentElement('afterend', newSelect);
            }

            if (clickCount > 2) {
                alert("결재 라인은 최대 3명까지 가능합니다."); // 경고창을 띄웁니다.
                document.getElementById("addButton").disabled = true; // 버튼 비활성화
            }
        }


        var today = new Date();
        var nextWeek = new Date();

        nextWeek.setDate(today.getDate() + 7);

        var minDate = nextWeek.toISOString().split('T')[0];

        var startDateInput = document.getElementById("startDate");
        startDateInput.setAttribute("min", minDate);
    </script>

</html>